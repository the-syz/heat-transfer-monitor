# 换热器性能监测与故障诊断系统架构设计

## 一、整体架构

基于现有代码模块与功能分析，系统采用分层架构设计，包含四个核心层次：

### 1.1 数据接入层

- **功能**：负责多源数据采集与标准化处理
- **实现**：
  - 传感器实时数据接入（HTRI_reader_property_moniter模块）
  - 历史数据批量导入（data_processing_1模块）
  - 数据库交互（heat_exchanger_monitor_my_try_2中的DataStreamController）

### 1.2 计算核心层

- **功能**：提供换热器核心物理计算能力
- **核心模块**：
  - **温度场计算**：基于LMTD和分段计算法（Ammonium_Salt_Fouling_Automated_Calculation/temperature_calculator.py）
  - **传热性能分析**：Wilson方法实现（data_processing_1/HeatTransferCalculator）
  - **压力降计算**：管壳程流动阻力模型（pressure_drop_calculator.py）
  - **结垢模拟**：铵盐结垢动态计算（unit_cal.py中的温度分布控制逻辑）
  - **集成分段计算引擎**：整合传热计算和结垢预测的分段计算，实现一体化模拟

#### 1.2.1 集成分段计算引擎详细设计

集成分段计算引擎是计算核心层的核心组件，将传热计算和结垢预测的分段计算有机结合，实现一体化模拟。

**主要功能：**
1. **在线性能监测（基于分段计算）**
   - **输入实时工况参数**：从DCS、PLC或传感器实时获取换热器的运行数据，包括管程流体流量、壳程流体流量、管程入口温度、壳程入口温度等
   - **模型初始化与分段**：根据换热器总长度L，将其在数值上划分为N个微元段（通常取50-200段），对未知出口温度进行初始假设
   - **分段迭代计算核心循环**：对每一个微元段i进行传热计算，包括：
     - 获取段入口条件：第i段的入口温度即为第i-1段的出口温度
     - 计算段内平均物性：根据段入口温度和对出口温度的估计值，计算该段的平均温度，并调用物性数据库查询该平均温度下的流体密度、粘度、比热、导热系数等
     - 计算局部传热系数：利用Wilson图解法标定出的传热关联式(Nu = C * Re^a * Pr^b)，结合该段的平均物性和流速，计算管程和壳程的局部对流给热系数
     - 计算总传热系数与换热量：根据当前的污垢热阻R_f，计算该段的总传热系数U_i，然后利用对数平均温差法（LMTD）或ε-NTU法计算该段的换热量dQ_i
     - 计算段出口温度：根据dQ_i = m*c_p*dT，计算出管程和壳程流出第i段时的出口温度，作为下一段的入口
   - **总体收敛判断与参数修正**：
     - 温度收敛：将计算出的总出口温度与初始假设的出口温度进行比较，如误差大于预设阈值，则用计算值作为新的假设值重新迭代，直到收敛
     - 性能监测（污垢热阻计算）：当温度迭代收敛后，将理论出口温度与实际测量的出口温度进行比较，以污垢热阻R_f为变量进行外循环，直到计算出的出口温度与实际测量的出口温度相匹配

2. **结垢预测与垢层厚度计算**
   - **结垢速率模型**：采用高精度经验模型描述温度与结垢量的关系，模型形式为y = a^(T - b)，其中y为结垢速率(kg/(m²·s))，T为温度(°C)，a和b为模型参数
   - **分段结垢计算**：对每个计算单元独立计算结垢速率和垢层厚度，计算公式为：δ_i(t+Δt) = δ_i(t) + (y_i * A_i * Δt) / (ρ * A_i)，其中δ_i为第i段垢层厚度
   - **段间耦合机制**：通过温度场和流动场的耦合计算，实现段间的相互影响传递
   - **边界条件处理**：入口和出口边界条件作为全局约束，确保各段计算结果满足整体能量守恒

3. **传热-结垢耦合计算流程**
   - **数据融合**：将传热计算得到的温度分布与结垢预测模型进行数据融合，实现双向耦合
   - **污垢热阻校准**：利用结垢预测模型对传热计算得到的污垢热阻进行辅助校准，提高计算精度
   - **垢层厚度直接输出**：计算得到的垢层厚度值直接输入健康矩阵中进行处理，无需从污垢热阻换算
   - **每日迭代更新**：采用1天为时间步长，每日更新各段的结垢状态和换热器参数，并根据更新后的垢层厚度，重新计算换热器的温度分布和流动阻力

**核心输出：**
- **关键性能指标**：总传热系数U、总换热量Q、等效污垢热阻R_f、换热效率等
- **内部状态分布**：沿换热器长度方向的温度分布曲线（管程、壳程、壁面）
- **垢层厚度分布**：沿换热器长度方向的垢层厚度分布，可直接用于健康矩阵分析
- **结垢预测结果**：未来一段时间内的结垢发展趋势预测

### 1.3 智能诊断层

- **功能**：实现性能评估与故障预测
- **关键组件**：
  - **健康矩阵构建**：多维度性能参数融合（HealthMatrixAnalyzer类）
  - **结垢预测**：CNN-LSTM混合模型（models/cnn_lstm.py）
  - **故障诊断**：基于聚类分析的故障模式识别（FaultDiagnoser类）

#### 1.3.1 健康矩阵构建与垢层厚度直接输入

健康矩阵是智能诊断层的核心数据结构，用于整合多维度性能参数并支持故障识别。

**HealthMatrixAnalyzer类核心功能：**
1. **数据融合机制**：
   - 接受主要性能参数（primary_params）：包括温度分布、压力降、流量等基础参数
   - 接受结垢相关参数（fouling_params）：直接接受垢层厚度分布数据，无需从污垢热阻换算
   - 支持实时数据增量添加与缓冲区管理

2. **垢层厚度直接输入设计**：
   - 接口设计：`build_health_matrix(primary_params, fouling_params)`方法支持直接传入垢层厚度分布数组
   - 数据结构：内部采用numpy数组存储，支持向量化计算
   - 数据处理：自动处理不同长度的段数据，实现数据标准化

3. **降维与可视化**：
   - 支持PCA/t-SNE降维算法，将高维健康矩阵转换为低维特征空间
   - 提供2D/3D可视化接口，直观展示换热器健康状态

4. **聚类分析**：
   - 基于K-Means聚类算法识别故障模式
   - 自动计算聚类中心，用于故障程度量化评估

**健康矩阵与集成分段计算引擎的交互流程：**
1. 集成分段计算引擎完成传热-结垢耦合计算，生成垢层厚度分布
2. 垢层厚度分布直接输入健康矩阵，无需经过污垢热阻换算
3. HealthMatrixAnalyzer类将垢层厚度与其他性能参数融合，构建完整健康矩阵
4. 对健康矩阵进行降维和聚类分析，识别故障模式并量化故障程度

### 1.4 应用接口层

- **功能**：提供标准化服务接口
- **接口类型**：
  - RESTful API：数据查询与控制接口
  - 实时数据流：WebSocket推送关键指标
  - 批处理接口：历史数据分析任务

## 二、后端模块划分

### 2.1 核心业务模块

| 模块名称               | 功能描述                | 关键文件                |
| ---------------------- | ----------------------- | ----------------------- |
| heat_transfer          | 传热系数与热阻计算      | heat_transfer_wilson.py |
| fouling_simulation     | 结垢生长模拟            | unit_cal.py             |
| performance_evaluation | 健康状态评估            | health_matrix.py        |
| fault_diagnosis        | 故障模式识别            | FaultDiagnoser类        |
| data_processing        | 传感器数据处理          | HTRI_rezder_new.py      |
| equipment_config       | 换热器类型与参数配置    | -                       |
| fouling_type           | 垢层类型管理            | -                       |
| property_manager       | 物性库管理与pyfluid集成 | -                       |
| alarm_system           | 多级故障报警机制        | -                       |
| report_generation      | 数据查询与报表生成      | -                       |

### 2.2 公共支撑模块

- **配置管理**：几何参数JSON配置（geometry_params.json）
- **数据存储**：时序数据与特征值管理（daily_stats存储结构）
- **可视化**：结垢3D展示与趋势图表（fouling_3d_visualization.py）
- **换热器类型管理**：支持不同类型换热器（管壳式、板式等）的参数化配置
- **垢层类型管理**：支持铵盐（NH4Cl、NH4HS）等多种垢层类型的特性参数定义
- **物性库管理**：集成pyfluid实现流体物性数据的动态获取与管理
- **报警配置管理**：多级报警阈值与规则配置
- **报表模板管理**：日报表、月报表模板配置与定制化

## 三、路由分配方案

基于RESTful设计原则，API路由按功能域划分：

### 3.1 数据接口

- `GET /api/v1/sensors` - 获取传感器列表
- `POST /api/v1/data/stream` - 推送实时监测数据
- `GET /api/v1/data/history` - 查询历史数据

### 3.2 计算接口

- `POST /api/v1/calculate/heat-transfer` - 传热性能计算
- `POST /api/v1/calculate/fouling` - 结垢预测
- `GET /api/v1/calculate/temperature-distribution` - 获取温度分布

### 3.3 诊断接口

- `GET /api/v1/diagnosis/health-index` - 查询健康指数
- `GET /api/v1/diagnosis/fault-modes` - 获取故障模式
- `POST /api/v1/diagnosis/evaluate` - 执行健康评估

### 3.4 系统接口

- `GET /api/v1/system/config` - 获取系统配置
- `PUT /api/v1/system/config` - 更新系统配置
- `GET /api/v1/system/status` - 查询系统状态

### 3.5 设备配置接口

- `GET /api/v1/equipment/types` - 获取支持的换热器类型列表
- `GET /api/v1/equipment/parameters/{type}` - 获取指定换热器类型的参数模板
- `POST /api/v1/equipment/config` - 保存换热器配置

### 3.6 垢层管理接口

- `GET /api/v1/fouling/types` - 获取支持的垢层类型列表
- `GET /api/v1/fouling/properties/{type}` - 获取指定垢层类型的特性参数
- `POST /api/v1/fouling/config` - 配置换热器垢层参数

### 3.7 物性库接口

- `GET /api/v1/properties/fluids` - 获取可用流体列表
- `GET /api/v1/properties/{fluid}/data` - 获取指定流体的物性数据
- `POST /api/v1/properties/calculate` - 计算特定条件下的流体物性

### 3.8 报警接口

- `GET /api/v1/alarm/settings` - 获取报警设置
- `PUT /api/v1/alarm/settings` - 更新报警设置
- `GET /api/v1/alarm/history` - 查询报警历史
- `POST /api/v1/alarm/acknowledge` - 确认报警

### 3.9 报表接口

- `GET /api/v1/report/templates` - 获取报表模板列表
- `POST /api/v1/report/generate` - 生成报表
- `GET /api/v1/report/{id}/download` - 下载报表
  基于RESTful设计原则，API路由按功能域划分：

## 四、数据流设计

1. **实时监测流**：
   传感器数据 → 数据验证 → 特征提取 → 集成分段计算引擎 → 传热-结垢耦合计算 → 垢层厚度分布 → 健康矩阵更新 → 异常检测
2. **结垢预测流**：
   历史数据 → 特征工程 → CNN-LSTM模型推理 → 结垢趋势预测 → 污垢热阻校准 → 集成分段计算引擎 → 可视化渲染
3. **故障诊断流**：
   多源参数（含垢层厚度分布） → 健康矩阵构建 → 降维处理 → 聚类分析 → 故障定位 → 诊断报告

## 五、技术栈选型

- **核心框架**：FastAPI（高性能异步接口）
- **计算引擎**：NumPy/SciPy（科学计算）
- **机器学习**：TensorFlow（模型训练）、scikit-learn（数据分析）
- **数据存储**：MySQL（统一使用MySQL存储所有数据）
- **前端框架**：Vue.js（参考vue-project路由配置）
- **UI组件库**：Element Plus（企业级UI组件）
- **数据可视化**：ECharts（动态曲线图）、Three.js（换热器3D展示）
- **状态管理**：Pinia（Vue3状态管理）
- **路由管理**：Vue Router（页面路由）
- **物性计算**：pyfluid（流体物性数据获取）
- **报表生成**：ReportLab（PDF报表）、OpenPyXL（Excel报表）
- **实时通信**：WebSocket（实时数据推送）

## 六、前端界面设计

### 6.1 整体页面结构

```
├── 公共组件
│   ├── 导航栏（Navbar）
│   ├── 侧边菜单（SideMenu）
│   ├── 页脚（Footer）
│   └── 面包屑导航（Breadcrumb）
├── 认证页面
│   ├── 登录页（Login）
│   └── 注册页（Register）
├── 总览页面（Home）
├── 换热器实时监测页面
├── 换热器管理页面
└── 故障预警页面
```

### 6.2 关键页面设计

#### 6.2.1 登录/注册页面

- **功能**：用户身份验证、权限管理
- **核心组件**：表单验证、验证码、记住密码功能
- **技术实现**：基于JWT的身份认证机制

#### 6.2.2 总览页面（Home）

- **功能**：显示所有换热器的总传热系数及警告信息
- **核心组件**：
  - 换热器状态卡片（显示关键指标和状态）
  - 总传热系数趋势图
  - 警告信息汇总列表
  - 系统运行状态指标

#### 6.2.3 换热器实时监测页面

- **功能**：显示单个换热器的实时状态和动态曲线图
- **核心组件**：
  - 换热器列表切换组件
  - 实时数据仪表盘（温度、压力、流量等）
  - 动态曲线图（多参数趋势对比）
  - 3D换热器模型（可选）
  - 数据导出按钮

#### 6.2.4 换热器管理页面

- **功能**：添加、修改、查询换热器信息
- **核心组件**：
  - 换热器数据表格（支持排序、筛选、分页）
  - 添加/编辑表单（包含基本信息、几何参数等）
  - 搜索功能
  - 批量操作按钮

#### 6.2.5 故障预警页面

- **功能**：显示所有换热器的警告信息及报告
- **核心组件**：
  - 预警等级分类标签
  - 换热器故障状态分布图
  - 故障详情弹窗
  - 故障报告生成与导出

### 6.3 前端交互设计

- **实时数据更新**：采用WebSocket实现数据推送
- **图表交互**：支持缩放、平移、数据点提示
- **页面导航**：面包屑导航+侧边栏组合
- **响应式设计**：适配桌面端和移动端
- **加载状态**：骨架屏+加载动画
- **错误处理**：友好的错误提示和恢复机制

### 6.4 前端组件结构设计

```
src/
├── assets/            # 静态资源
├── components/        # 公共组件
│   ├── common/        # 通用组件(按钮、表单等)
│   ├── dashboard/     # 仪表盘组件
│   ├── monitoring/    # 监测页面组件
│   ├── management/    # 管理页面组件
│   └── warning/       # 预警页面组件
├── views/             # 页面组件
│   ├── Login.vue
│   ├── Register.vue
│   ├── Home.vue
│   ├── Monitoring.vue
│   ├── Management.vue
│   └── Warning.vue
├── router/            # 路由配置
├── store/             # 状态管理
├── services/          # API服务
├── utils/             # 工具函数
└── App.vue            # 根组件
```

### 6.5 状态管理设计

系统采用Pinia进行状态管理，主要管理换热器列表、当前选中换热器信息、实时监测数据、预警信息等核心数据状态，并提供数据获取、更新、删除、添加和实时数据订阅等操作方法，以及健康状态计数、警告计数、紧急状态计数等计算属性。

### 6.6 前端安全考虑

- **认证与授权**：基于JWT的Token认证机制
- **数据验证**：前后端双重验证
- **XSS防护**：输入过滤与输出编码
- **CSRF防护**：Token验证
- **敏感信息保护**：敏感数据加密存储
- **API请求限制**：请求频率限制

### 6.7 前端构建与部署

- **构建工具**：Vite
- **代码规范**：ESLint + Prettier
- **测试框架**：Jest + Vue Test Utils
- **部署方式**：Docker容器化部署
- **CI/CD**：GitHub Actions自动化流程

### 6.1 整体页面结构

```
├── 公共组件
│   ├── 导航栏（Navbar）
│   ├── 侧边菜单（SideMenu）
│   ├── 页脚（Footer）
│   └── 面包屑导航（Breadcrumb）
├── 认证页面
│   ├── 登录页（Login）
│   └── 注册页（Register）
├── 总览页面（Home）
├── 换热器实时监测页面
├── 换热器管理页面
└── 故障预警页面
```

### 6.2 关键页面设计

#### 6.2.1 登录/注册页面

- **功能**：用户身份验证、权限管理
- **核心组件**：表单验证、验证码、记住密码功能
- **技术实现**：基于JWT的身份认证机制

#### 6.2.2 总览页面（Home）

- **功能**：显示所有换热器的总传热系数及警告信息
- **核心组件**：
  - 换热器状态卡片（显示关键指标和状态）
  - 总传热系数趋势图
  - 警告信息汇总列表
  - 系统运行状态指标

#### 6.2.3 换热器实时监测页面

- **功能**：显示单个换热器的实时状态和动态曲线图
- **核心组件**：
  - 换热器列表切换组件
  - 实时数据仪表盘（温度、压力、流量等）
  - 动态曲线图（多参数趋势对比）
  - 3D换热器模型（可选）
  - 数据导出按钮

#### 6.2.4 换热器管理页面

- **功能**：添加、修改、查询换热器信息
- **核心组件**：
  - 换热器数据表格（支持排序、筛选、分页）
  - 添加/编辑表单（包含基本信息、几何参数等）
  - 搜索功能
  - 批量操作按钮

#### 6.2.5 故障预警页面

- **功能**：显示所有换热器的警告信息及报告
- **核心组件**：
  - 预警等级分类标签
  - 换热器故障状态分布图
  - 故障详情弹窗
  - 故障报告生成与导出

### 6.3 前端交互设计

- **实时数据更新**：采用WebSocket实现数据推送
- **图表交互**：支持缩放、平移、数据点提示
- **页面导航**：面包屑导航+侧边栏组合
- **响应式设计**：适配桌面端和移动端
- **加载状态**：骨架屏+加载动画
- **错误处理**：友好的错误提示和恢复机制

## 七、前后端接口交互设计

### 7.1 认证接口

- `POST /api/v1/auth/login` - 用户登录
- `POST /api/v1/auth/register` - 用户注册
- `GET /api/v1/auth/me` - 获取当前用户信息

### 7.2 前端路由配置

前端路由配置包括登录页、注册页、总览页、换热器实时监测页、换热器管理页和故障预警页等主要页面的路由定义，并通过meta字段设置权限控制。实时监测页面支持通过URL参数接收换热器ID。

### 7.3 数据交互流程

1. **登录流程**：

   - 用户提交凭证 → 后端验证 → 返回JWT令牌 → 前端存储令牌并跳转
2. **实时监测流程**：

   - 选择换热器 → 建立WebSocket连接 → 后端推送实时数据 → 前端动态更新图表
3. **数据管理流程**：

   - 提交表单 → 前端验证 → 调用API → 后端处理 → 返回结果 → 前端更新UI

## 八、换热器类型与垢层类型管理设计

- **核心框架**：FastAPI（高性能异步接口）
- **计算引擎**：NumPy/SciPy（科学计算）
- **机器学习**：TensorFlow（模型训练）、scikit-learn（数据分析）
- **数据存储**：InfluxDB（时序数据）、PostgreSQL（关系数据）
- **前端框架**：Vue.js（参考vue-project路由配置）
- **物性计算**：pyfluid（流体物性数据获取）

## 八、换热器类型与垢层类型管理设计

### 6.1 换热器类型管理

- **支持类型**：管壳式、板式、翅片式等常见换热器类型
- **参数配置**：每种类型换热器提供专用参数模板，包括几何结构参数、材料特性参数等
- **动态切换**：支持在运行时切换不同类型换热器的计算模型

### 6.2 垢层类型管理

- **内置垢层类型**：
  - 铵盐类：NH4Cl、NH4HS
  - 碳酸盐类：CaCO3、MgCO3
  - 硫酸盐类：CaSO4、BaSO4
  - 硅酸盐类
  - 腐蚀产物
- **垢层特性**：为每种垢层类型定义热阻系数、生长速率模型、物理特性等参数
- **混合垢层**：支持多种垢层类型的混合计算模型

### 6.3 基于pyfluid的物性数据管理

- **数据获取流程**：
  1. 用户选择流体类型和状态参数（温度、压力等）
  2. 系统调用pyfluid接口计算流体物性
  3. 返回密度、粘度、比热容、导热系数等关键参数
- **缓存机制**：对常用工况下的物性数据进行缓存，提高计算效率
- **自定义流体**：支持用户定义混合流体的物性计算方法

## 九、关键功能补充设计

### 9.1 性能评价详细设计

#### 9.1.1 性能评分计算逻辑

- **单参数评分**：基于参数实际值与允许范围的偏差，采用线性评分法：
  - 实际值在允许范围内：评分=100
  - 实际值超出允许范围：评分=100 - (|实际值-上限|/上限)×100（超出上限），或100 - (|下限-实际值|/下限)×100（低于下限）
- **权重分配**：
  - 传热性能评分（含传热系数、进出口温差）权重60%
  - 阻力性能评分（含管程/壳程压降）权重40%
- **总评分计算**：总分=传热评分×0.6+阻力评分×0.4

#### 9.1.2 性能分级标准

- **一级（优秀）**：总分≥90
- **二级（良好）**：75≤总分＜90
- **三级（较差）**：60≤总分＜75
- **四级（严重）**：总分＜60

### 9.2 故障报警系统设计

#### 9.2.1 三级报警机制

- **一级报警（提醒）**：结垢率≥29%或堵塞率≥35%，系统提示，无报警声
- **二级报警（警告）**：结垢率≥42%（清洗阈值），弹出警告框+报警声
- **三级报警（紧急）**：堵塞率≥62%（维修阈值），弹出紧急框+持续报警声

#### 9.2.2 故障原因与建议系统

- **原因库匹配**：系统内置故障原因库，根据故障类型与参数偏差自动匹配
- **建议生成**：基于原因库关联处理建议，提供具体操作指导

### 9.3 数据库设计概述

数据库设计将在后续单独文档中详细描述，主要包括结构尺寸数据、采集数据、故障信息、用户信息和物性参数等核心数据的存储方案。系统统一采用MySQL数据库进行数据管理。

### 9.4 工程案例适配设计

#### 9.4.1 浮头式换热器适配

- **结构参数预设**：数据库内置浮头式换热器结构模板
- **工艺参数默认值**：管程介质循环冷却水、壳程介质工艺水的默认参数
- **故障阈值**：结垢阈值29%、清洗阈值42%、堵塞阈值35%、维修阈值62%

#### 9.4.2 石脑油管壳式换热器适配

- **物性参数补充**：数据库添加石脑油物性参数
- **结垢模型调整**：渐近污垢热阻R_f^*=0.018 m²·K/W，时间常数t_c=26.5243d
- **阈值调整**：结垢阈值45%、清洗阈值75%、维修阈值45%

#### 9.4.3 高压加氢换热器适配

- **介质数据库扩充**：添加反应产物、循环氢物性参数
- **结垢模型导入**：导入NH4Cl、NH4HS结垢速率预测模型
- **监测周期适配**：支持长周期监测（如6年），数据存储间隔可设置为1天

### 9.5 结垢预测计算流程详细设计

#### 9.5.1 结垢速率模型建立

- **基础模型**：采用高精度经验模型描述温度与结垢量(kg/s)的关系，模型形式为y = a^(T - b)，其中y为结垢速率(kg/(m²·s))，T为温度(°C)，a和b为模型参数
- **多参数扩展**：支持将压力、流速、浓度等更多参数纳入模型，采用多项式拟合或神经网络模型建立多参数关联关系
- **模型参数管理**：为不同介质和工况提供模型参数库，支持参数查询、更新和自定义

#### 9.5.2 机器学习模型更新机制

- **在线学习**：系统支持基于实时采集数据的在线模型更新，定期重新训练结垢预测模型以提高预测精度
- **增量学习**：采用增量学习算法，仅使用新数据更新模型，避免全量数据重新训练
- **模型评估**：定期评估模型预测准确性，当误差超过预设阈值时自动触发模型更新
- **版本管理**：对不同版本的模型进行管理，支持模型回滚和对比分析

#### 9.5.3 分段计算方法

- **换热器分段**：将换热器沿长度方向划分为若干计算单元（通常为20-50段），每段内假设温度、流速等参数均匀分布
- **局部结垢计算**：对每个单元独立计算结垢速率和垢层厚度，计算公式为：
  δ_i(t+Δt) = δ_i(t) + (y_i * A_i * Δt) / (ρ * A_i)
  其中δ_i为第i段垢层厚度，y_i为第i段结垢速率，A_i为第i段换热面积，ρ为垢层密度，Δt为时间步长
- **段间耦合**：通过温度场和流动场的耦合计算，考虑段间的相互影响和参数传递
- **边界条件处理**：入口和出口边界条件作为全局约束，确保各段计算结果满足整体能量守恒

#### 9.5.4 每日迭代更新流程

- **时间步长设置**：采用1天为时间步长，兼顾计算效率和精度
- **日数据处理**：每日对采集数据进行预处理，计算各段平均温度、压力、流速等参数
- **结垢量更新**：基于日平均参数计算各段结垢增量，更新垢层厚度分布
- **参数反馈**：根据更新后的垢层厚度，重新计算换热器的温度分布和流动阻力，并反馈到下一轮迭代
- **收敛性判断**：通过比较相邻两次迭代的关键参数变化量，判断计算是否收敛

#### 9.5.5 数据存储设计

- **时序数据存储**：将每日结垢预测结果（包括各段垢层厚度、温度分布、结垢速率等）存储为时序数据
- **特征值提取**：从原始数据中提取关键特征值（如最大结垢厚度、平均结垢率等），用于性能评估和故障诊断
- **历史对比数据**：存储历史结垢趋势数据，支持不同时间段的对比分析
- **数据压缩**：对长期运行数据采用压缩存储策略，优化存储空间和查询性能

#### 9.5.6 计算结果可视化

- **二维分布展示**：以二维曲线图形式展示沿换热器长度方向的结垢厚度分布
- **三维模型展示**：通过Three.js实现换热器的3D可视化，直观展示结垢分布情况
- **趋势分析图表**：提供结垢厚度随时间变化的趋势图，支持多参数对比分析
- **异常点标记**：自动识别并标记结垢异常增长区域，帮助运维人员快速定位问题

## 十、程序运行流程

### 10.1 初始化阶段

1. 用户登录：输入账号密码，系统验证后加载用户权限与默认参数
2. 参数设置：选择换热器类型→导入/输入结构与工艺参数→配置采集卡→设置故障阈值与参数上下限
3. 模型加载：加载传热计算模型、结垢预测模型，初始化数据库连接

### 10.2 监测运行阶段

1. 数据采集：实时读取传感器数据，预处理后存入MySQL数据库
2. 实时计算：
   - 传热-阻力计算模块计算总传热系数与压降
   - 结垢预测模块执行以下计算流程：
     - 基于高精度经验模型（y = a^(T - b)）计算结垢速率
     - 将换热器沿长度方向划分为20-50个计算单元，对每个单元独立计算结垢速率
     - 采用每日迭代更新策略，公式：δ_i(t+Δt) = δ_i(t) + (y_i * A_i * Δt) / (ρ * A_i)
     - 根据更新后的垢层厚度，重新计算换热器的温度分布和流动阻力
     - 推导结垢率、堵塞率等关键指标
     - 定期使用机器学习模型对结垢预测模型进行在线更新
3. 故障判断：对比故障程度与阈值，触发相应等级报警
4. 性能评价：计算传热/阻力评分与总评分，确定性能级别，实时更新界面

### 10.3 数据查询与分析阶段

1. 用户选择查询条件（时间范围、参数类型），系统从MySQL数据库读取数据
2. 以表格与曲线展示结果，支持超阈值数据筛选
3. 导出报表：用户选择"导出Excel/PDF"，系统自动生成含统计数据与趋势图的报表

## 十一、关键技术说明

### 11.1 混合编程技术

- **计算引擎集成**：支持多种计算引擎的集成调用，实现高效的复杂计算
- **模型管理**：统一的模型加载、更新与版本控制机制

### 11.2 阈值确定技术

- **EWMA方法**：通过指数加权移动平均控制图（λ=0.3，L=3）确定参数阈值，虚警率控制在1%以内
- **多方法融合**：结合启发式方法（历史数据）、统计方法（EWMA）、用户自定义，确保阈值准确性

### 11.3 数据库交互技术

- **MySQL连接池**：采用连接池技术优化数据库连接性能
- **数据同步机制**：确保实时数据与历史数据的一致性，支持多客户端同时访问

## 十二、扩展说明

本架构基于现有代码模块抽象设计，综合了论文程序结构中的核心功能，统一使用MySQL数据库存储所有数据，包括本地采集数据、用户信息、参数模板和远程监测数据等。